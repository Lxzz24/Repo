## 变量

什么是变量？

变量就是初中数学的代数的概念，例如一个简单的方程，x，y都是变量：

$y = x^2 + 1$

### 1 概念：

- 内存中的一个存储区域
  - 该区域的数据可以在同一类型范围内不断变化
  - 变量是程序中最基本的存储单元
  - 包含变量类型、变量名和存储的值

### 2 作用：

- 用于在内存中保存数据
- 使用变量名来访问这块区域的数据
- 变量的作用域：定义所在的一对`{}`内

### 3 变量的使用

Java 定义变量的格式：

```java
    //1
    数据类型 变量名 = 变量值；
 
    //2
    数据类型 变量名；
    变量名 = 变量值;  
```

> [!ATTENTION]
> ① ***变量必须先声明，后使用***。  
> ② 变量都定义在其作用域内。在作用域内，它是有用的。换句话说，出了作用域，就失效了。  
> ③ 同一个作用域内，不可以声明两个同名的变量。  

来看一个完整的定义变量，然后打印变量值的例子：

```java
public class Main {
    public static void main(String[] args) {
        int x = 100; // 定义int类型变量x，并赋予初始值100
        System.out.println(x); // 打印该变量的值
    }
}
```

***变量的一个重要特点是可以重新赋值。*** 例如，对变量x，先赋值100，再赋值200，观察两次打印的结果：

```java
public class Main {
    public static void main(String[] args) {
        int x = 100; // 定义int类型变量x，并赋予初始值100
        System.out.println(x); // 打印该变量的值，观察是否为100
        x = 200; // 重新赋值为200
        System.out.println(x); // 打印该变量的值，观察是否为200
    }
}
```

注意到第一次定义变量 `x` 的时候，需要指定变量类型 `int`，因此使用语句 `int x = 100;`。而第二次重新赋值的时候，变量 `x` 已经存在了，不能再重复定义，因此不能指定变量类型 `int`，必须使用语句 `x = 200;`。

***变量不但可以重新赋值，还可以赋值给其他变量。*** 让我们来看一个例子：

```java
public class Main {
    public static void main(String[] args) {
        int n = 100; // 定义变量n，同时赋值为100
        System.out.println("n = " + n); // 打印n的值

        n = 200; // 变量n赋值为200
        System.out.println("n = " + n); // 打印n的值

        int x = n; // 变量x赋值为n（n的值为200，因此赋值后x的值也是200）
        System.out.println("x = " + x); // 打印x的值

        x = x + 100; // 变量x赋值为x+100（x的值为200，因此赋值后x的值是200+100=300）
        System.out.println("x = " + x); // 打印x的值
        System.out.println("n = " + n); // 再次打印n的值，n应该是200还是300？
   }
}
```

我们一行一行地分析代码执行流程：

执行 `int n = 100;`，该语句定义了变量 `n`，同时赋值为 `100`，因此，JVM 在内存中为变量 `n` 分配一个“存储单元”，填入值 `100`：

![1](https://cdn.gxmnzl.xyz//img/202206011416996.png)

执行 `n = 200;` 时，JVM 把 `200` 写入变量 `n` 的存储单元，因此，原有的值被覆盖，现在 `n` 的值为 `200`：

![2](https://cdn.gxmnzl.xyz//img/202206011417280.png)

执行 `int x = n;` 时，定义了一个新的变量 `x`，同时对 `x` 赋值，因此，JVM 需要 ***新分配*** 一个存储单元给变量 `x`，并写入和变量 `n` 一样的值，结果是变量 `x` 的值也变为 `200`：

![3](https://cdn.gxmnzl.xyz//img/202206011417106.png)

执行 `x = x + 100;` 时，JVM 首先计算等式右边的值 `x + 100`，结果为 `300`（因为此刻 `x` 的值为 `200`），然后，将结果 `300` 写入 `x` 的存储单元，因此，变量 `x` 最终的值变为 `300`：

![4](https://cdn.gxmnzl.xyz//img/202206011417253.png)

可见，*变量可以反复赋值*。注意，等号 `=` 是赋值语句，不是数学意义上的相等，否则无法解释 `x = x + 100`。




---

## 数据类型

### 分类
#### 1 按照数据类型来分

![image.png](https://cdn.gxmnzl.xyz/img/SE0213.png)


#### 2 按变量在类中声明的位置*

在方法体外，类体内声明的变量称为 ***成员变量*** 。  

在方法体内部声明的变量称为 ***局部变量*** 。

![image.png](https://cdn.gxmnzl.xyz/img/SE0214.png)

### 基本数据类型

基本数据类型是 CPU 可以直接进行运算的类型。Java 定义了以下几种基本数据类型：

- 整数类型： ***byte***， ***short***， ***int***， ***long***
- 浮点数类型： ***float***， ***double***
- 字符类型： ***char***
- 布尔类型： ***boolean***

#### ① 整数类型

- ***byte***（1 字节 = 8 bit） ：-128 ~ 127
- ***short***（2 字节）: -32768 ~ 32767
- ***int***（4 字节）: -2147483648 ~ 2147483647
- ***long***（8 字节）: -9223372036854775808 ~ 9223372036854775807

```java
public class Main {
    public static void main(String[] args) {
        int i = 2147483647;
        int i2 = -2147483648;
        int i3 = 2_000_000_000; // 加下划线更容易识别
        int i4 = 0xff0000; // 十六进制表示的16711680
        int i5 = 0b1000000000; // 二进制表示的512
        long l = 9000000000000000000L; // long型的结尾需要加L
    }
}
```

!> 通常定义整型变量时，使用 ***int*** 型

#### ② 浮点类型

***float***（4 字节） \ ***double***（8 字节）

浮点类型的数就是小数，因为小数用科学计数法表示的时候，小数点是可以“浮动”的，如 $1234.5$ 可以表示成 $12.345*10^2$ ，也可以表示成 $1.2345*10^3$ ，所以称为浮点数。

```java
    float f1 = 3.14f;
    float f2 = 3.14e38f; // 科学计数法表示的3.14x10^38
    double d = 1.79e308;
    double d2 = -1.79e308;
    double d3 = 4.9e-324; // 科学计数法表示的4.9x10^-324
```

对于 ***float*** 类型，需要加上 `f` / `F` 后缀。

浮点数可表示的范围非常大 ***float*** 类型可最大表示 $3.4*10^{38}$ ，而 ***double*** 类型可最大表示 $1.79*10^{308}$ 。

!> 通常，定义浮点型变量时，使用 ***double*** 型

#### ③ 字符类型

***char***（1 字符 = 2 字节）

1. 定义 ***char*** 型变量，通常使用一对  `'` `'` ，内部只能写一个字符
2. 表示方式：
   1. 声明一个字符
   2. 转义字符 
   3. 直接使用 Unicode 值表示字符型常量
      - ASCII 码
         - 8 个二进制位，共规定了 128 个字符的编码
      - Unicode 编码
      - UTF-8

```java
public class Main {
    public static void main(String[] args) {
        char a = 'A';
        char zh = '中';
        System.out.println(a);
        System.out.println(zh);
    }
}
```

> [!TIP]
> - `\n` 换行符
> - `\t` 制表符
> - `\b` 退格符
> - `\r` 回车符
> - `\"` 双引号
> - `\'` 单引号
> - `\\` 反斜线


> [!ATTENTION]
> 命令行是以 GBK 编码运行的，无法识别 UTF-8 的字符（EditPlus 中 ANSI 就等同于 GBK 编码）


#### ④ 布尔类型

***boolean***
	
1. 只能取两个值之一：true 、false
2. 布尔类型总是 *关系运算* 的计算结果
3. 常常在条件判断、循环结构中使用

```java
    boolean b1 = true;
    boolean b2 = false;
    boolean isGreater = 5 > 3; // 计算结果为true
    int age = 12;
    boolean isAdult = age >= 18; // 计算结果为false
```



### 引用数据类型

引用类型最常用的就是 `String` 字符串：

```java
    String s = "hello";
```

引用类型的变量类似于 C 语言的指针，它内部存储一个“地址”，指向某个对象在内存的位置，后续我们介绍 [类的概念](/1-Develop/Java/Note/2_面向对象/Java基本元素) 时会详细讨论。


> [!NOTE]
> *String* 类型变量的使用
> 1. String 属于引用数据类型，翻译为：字符串
> 2. 声明 String 类型变量时，使用一对`"` `"`
> 3. String 可以和 8 种基本数据类型变量做运算，且运算只能是连接运算。
> 4. 运算的结果仍是 String 类型


### 常量

定义变量的时候，如果加上 `final` 修饰符，这个变量就变成了 ***常量*** ：
```java
    final double PI = 3.14; // PI是一个常量
    double r = 5.0;
    double area = PI * r * r;
    PI = 300; // compile error!
```

***常量在定义时进行初始化后就不可再次赋值，再次赋值会导致编译错误*** 。

常量的作用是*用有意义的变量名来避免魔术数字*（Magic number），例如，不要在代码中到处写 `3.14`，而是定义一个常量。如果将来需要提高计算精度，我们只需要在常量的定义处修改，例如，改成 `3.1416`，而不必在所有地方替换 `3.14`。

根据习惯， ***常量名通常全部大写*** 。

> [!TIP]
> 编码情况：
> - 整型常量，默认类型为 int 型；
> - 浮点型常量，默认类型为 double 型。


### var 关键字
​
有些时候，类型的名字太长，写起来比较麻烦。例如：

```java
    StringBuilder sb = new StringBuilder();
```

这个时候，如果想省略变量类型，可以使用 `var` 关键字：

```java
    var sb = new StringBuilder();
```

编译器会根据赋值语句自动推断出变量 `sb` 的类型是 `StringBuilder`。对编译器来说，语句：

```java
    var sb = new StringBuilder();
```

实际上会自动变成：

```java
    StringBuilder sb = new StringBuilder();
```

因此，使用 `var` 定义变量，仅仅是少写了变量类型而已。


### 变量的作用范围

在 Java 中，多行语句用 `{` `}` 括起来。很多控制语句，例如条件判断和循环，都以 `{` `}` 作为它们自身的范围，例如：

```java
if (...) { // if开始
    ...
    while (...) { // while 开始
        ...
        if (...) { // if开始
            ...
        } // if结束
        ...
    } // while结束
    ...
} // if结束
```

只要正确地嵌套这些 `{` `}`，编译器就能识别出语句块的开始和结束。而在语句块中定义的变量，它有一个作用域，就是从定义处开始，到语句块结束。超出了作用域引用这些变量，编译器会报错。举个例子：

```java
{
    ...
    int i = 0; // 变量i从这里开始定义
    ...
    {
        ...
        int x = 1; // 变量x从这里开始定义
        ...
        {
            ...
            String s = "hello"; // 变量s从这里开始定义
            ...
        } // 变量s作用域到此结束
        ...
        // 注意，这是一个新的变量s，它和上面的变量同名，
        // 但是因为作用域不同，它们是两个不同的变量:
        String s = "hi";
        ...
    } // 变量x和s作用域到此结束
    ...
} // 变量i作用域到此结束
```

定义变量时，要遵循作用域最小化原则，尽量将变量定义在尽可能小的作用域，并且，不要重复使用变量名。


